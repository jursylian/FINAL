# Полный стек технологий

[< Назад к содержанию](README.md) | [Далее: Схемы БД >](02-database-schemas.md)

---

## Общая архитектура

```
┌──────────────────────────────────────────────────────────────┐
│                        Клиент (Браузер)                      │
│                                                              │
│  React 18 + React Router DOM 6 + Tailwind CSS 4 + Vite 7    │
│                                                              │
│  localStorage: token ─────────────────────────────┐          │
│                                                   │          │
│  apiClient.js ──► fetch() + Authorization: Bearer │          │
└──────────────────────┬───────────────────────────────────────┘
                       │ HTTP/REST (JSON + multipart/form-data)
                       ▼
┌──────────────────────────────────────────────────────────────┐
│                     Сервер (Node.js)                         │
│                                                              │
│  Express 5 ──► Routes ──► Middlewares ──► Controllers        │
│                                              │               │
│                              Mongoose 9 (ODM) ──► MongoDB    │
│                                                              │
│  JWT (jsonwebtoken) · bcryptjs · Multer · CORS · dotenv      │
└──────────────────────────────────────────────────────────────┘
```

---

## Backend

### Node.js (runtime)

| | |
|---|---|
| **Что это** | JavaScript-среда выполнения на движке V8 |
| **Зачем** | Позволяет писать серверный код на JavaScript — тот же язык, что и на frontend |
| **Какую проблему решает** | Единый язык для всего проекта. Не нужно переключаться между языками. Асинхронная модель ввода/вывода эффективна для API-серверов с множеством параллельных запросов |
| **Версия** | 18+ |

### Express 5 (web-фреймворк)

| | |
|---|---|
| **Что это** | Минималистичный HTTP-фреймворк для Node.js |
| **Зачем** | Обработка HTTP-запросов, маршрутизация, middleware-конвейер |
| **Какую проблему решает** | Без фреймворка пришлось бы вручную парсить URL, метод, тело запроса, управлять маршрутами. Express предоставляет `app.get()`, `app.post()`, `router`, `middleware` — стандартные инструменты для REST API |
| **Почему Express, а не Fastify/Koa/Nest** | Express — самый популярный фреймворк для Node.js с огромным сообществом. Идеален для учебного проекта: простой, понятный, множество примеров |
| **Версия** | 5.2.1 |

**Как используется в проекте:**

```
app.js
├── cors()                      ← middleware: разрешает cross-origin запросы
├── express.json()              ← middleware: парсит JSON body
├── app.use("/api/auth", ...)   ← монтирует группу роутов
├── app.use("/api/users", ...)
├── app.use("/api/posts", ...)
├── ...
├── 404 handler                 ← ловит несуществующие маршруты
└── error handler               ← глобальная обработка ошибок
```

### MongoDB (база данных)

| | |
|---|---|
| **Что это** | Документо-ориентированная NoSQL база данных |
| **Зачем** | Хранение всех данных: пользователи, посты, лайки, комментарии, подписки, уведомления |
| **Какую проблему решает** | Гибкая схема документов (JSON-подобные объекты). Не нужно проектировать жёсткую реляционную схему. Легко добавлять новые поля без миграций. Встроенная поддержка `$sample` (случайная выборка для Explore), `$lookup` (аналог JOIN), aggregation pipeline |
| **Почему MongoDB, а не PostgreSQL** | Для проекта типа Instagram с изменяемой структурой данных документная модель удобнее. Нет необходимости в сложных JOIN — связи между коллекциями реализуются через `$lookup` и `populate()` |

### Mongoose 9 (ODM)

| | |
|---|---|
| **Что это** | Object Document Mapper для MongoDB |
| **Зачем** | Определение схем, валидация, middleware (pre/post hooks), `populate()` для связей между коллекциями |
| **Какую проблему решает** | Нативный драйвер MongoDB не даёт валидации и типизации. Mongoose позволяет описать схему с типами, ограничениями, индексами, виртуальными полями, middleware |
| **Версия** | 9.1.5 |

**Ключевые возможности, используемые в проекте:**

| Возможность | Где используется |
|---|---|
| `Schema` + типы полей | Все модели: User, Post, Like, Comment, Follow, Notification |
| `unique` индексы | User (email, username), Like (userId+postId), Follow (followerId+followingId) |
| `select: false` | User.password, User.resetPasswordTokenHash — поля не включаются в запросы по умолчанию |
| `pre('save')` hook | User — автоматическое хеширование пароля перед сохранением |
| `methods` | User.comparePassword() — проверка пароля |
| `populate()` | Подгрузка связанных документов (автор поста, пользователь комментария) |
| `aggregate()` | Построение ленты с `$lookup`, `$match`, `$sort`, `$skip`, `$limit` |
| `timestamps: true` | Автоматические поля `createdAt`, `updatedAt` |

### jsonwebtoken (JWT)

| | |
|---|---|
| **Что это** | Библиотека для создания и верификации JSON Web Tokens |
| **Зачем** | Аутентификация пользователей без хранения сессий на сервере |
| **Какую проблему решает** | Stateless-аутентификация: сервер не хранит информацию о сессиях. Токен содержит ID пользователя (`sub`), подписан секретным ключом, имеет срок действия. При каждом запросе клиент отправляет токен — сервер проверяет подпись и извлекает userId |
| **Версия** | 9.0.2 |

**Структура токена:**

```
Header:    { "alg": "HS256", "typ": "JWT" }
Payload:   { "sub": "userId", "iat": 1234567890, "exp": 1234567890 }
Signature: HMACSHA256(header + payload, JWT_SECRET)
```

### bcryptjs (хеширование паролей)

| | |
|---|---|
| **Что это** | Реализация алгоритма bcrypt на чистом JavaScript |
| **Зачем** | Безопасное хранение паролей в базе данных |
| **Какую проблему решает** | Пароли никогда не хранятся в открытом виде. bcrypt: 1) добавляет случайную «соль» к паролю, 2) выполняет 10 раундов хеширования (намеренно медленный алгоритм), 3) даже при утечке БД пароли невозможно восстановить |
| **Почему bcryptjs, а не bcrypt** | `bcryptjs` — чистый JavaScript, не требует компиляции нативных модулей. Проще установка, работает на любой платформе |
| **Версия** | 2.4.3 |

### Multer (загрузка файлов)

| | |
|---|---|
| **Что это** | Middleware для Express для обработки `multipart/form-data` |
| **Зачем** | Загрузка изображений (аватары, фото постов) |
| **Какую проблему решает** | Express не умеет парсить `multipart/form-data` из коробки. Multer перехватывает файл из запроса, помещает его в `req.file` (буфер в памяти), после чего контроллер конвертирует его в Base64 Data URL |
| **Версия** | 1.4.5-lts.1 |

**Конфигурация:**

```
memoryStorage()  ← файл хранится в RAM как Buffer (не на диске)
fileSize: 5MB    ← максимальный размер файла
```

### cors (Cross-Origin Resource Sharing)

| | |
|---|---|
| **Что это** | Middleware для настройки CORS-заголовков |
| **Зачем** | Разрешить frontend (localhost:5173) отправлять запросы на backend (localhost:4000) |
| **Какую проблему решает** | Браузеры по умолчанию блокируют запросы между разными origin (порт, домен, протокол). Без CORS frontend не сможет обращаться к API |
| **Версия** | 2.8.6 |

**Конфигурация:**

```
origin: ["http://localhost:5173", "http://localhost:5174", "http://localhost:5175"]
credentials: true
```

### dotenv (переменные окружения)

| | |
|---|---|
| **Что это** | Загрузчик переменных из файла `.env` в `process.env` |
| **Зачем** | Хранение конфигурации (порт, подключение к БД, секретный ключ JWT) вне кода |
| **Какую проблему решает** | Конфиденциальные данные (JWT_SECRET, MONGO_URI) не попадают в git. Разные конфигурации для dev/prod без изменения кода |
| **Версия** | 17.2.3 |

### nodemon (dev-утилита)

| | |
|---|---|
| **Что это** | Утилита для автоматического перезапуска Node.js при изменении файлов |
| **Зачем** | Удобство разработки — не нужно вручную перезапускать сервер после каждого изменения |
| **Какую проблему решает** | При обычном `node server.js` сервер не видит изменения в коде. nodemon отслеживает файлы и перезапускает процесс автоматически |
| **Версия** | 3.1.11 |

---

## Frontend

### React 18 (UI-библиотека)

| | |
|---|---|
| **Что это** | Библиотека для построения пользовательских интерфейсов на основе компонентов |
| **Зачем** | Декларативное описание UI, компонентная архитектура, реактивное обновление при изменении данных |
| **Какую проблему решает** | Без React пришлось бы вручную манипулировать DOM, отслеживать изменения данных и обновлять элементы. React автоматически обновляет UI при изменении state/props через виртуальный DOM |
| **Версия** | 18.3.1 |

**Ключевые хуки, используемые в проекте:**

| Хук | Где используется |
|---|---|
| `useState` | Локальное состояние во всех компонентах |
| `useEffect` | Загрузка данных при монтировании, debounce в поиске |
| `useContext` | Глобальное состояние авторизации (AuthContext) |
| `useNavigate` | Программная навигация (после логина, при клике на пользователя) |
| `useParams` | Извлечение параметров из URL (`/profile/:id`, `/post/:id`) |

### Vite 7 (сборщик)

| | |
|---|---|
| **Что это** | Быстрый сборщик и dev-сервер для frontend-приложений |
| **Зачем** | Мгновенный запуск dev-сервера, Hot Module Replacement (HMR), сборка для production |
| **Какую проблему решает** | Webpack медленный на старте (анализирует все файлы). Vite использует нативные ES-модули браузера в dev-режиме — сервер стартует за миллисекунды, обновления применяются мгновенно |
| **Почему Vite, а не Webpack/CRA** | Create React App устарел и больше не поддерживается. Vite — современный стандарт: быстрее, проще конфигурация, меньше зависимостей |
| **Версия** | 7.2.4 |

### React Router DOM 6 (роутинг)

| | |
|---|---|
| **Что это** | Библиотека маршрутизации для React SPA |
| **Зачем** | Навигация между страницами без перезагрузки (client-side routing) |
| **Какую проблему решает** | React сам по себе — это одна страница (SPA). Router позволяет отображать разные компоненты в зависимости от URL, поддерживает вложенные маршруты, параметры URL, программную навигацию, защищённые маршруты |
| **Версия** | 6.28.0 |

**Ключевые возможности:**

| Возможность | Как используется |
|---|---|
| `<Routes>` / `<Route>` | Дерево маршрутов в App.jsx |
| Вложенные маршруты | Все защищённые страницы вложены в `<AppLayout>` |
| `<Navigate>` | Редирект на `/login` при отсутствии токена |
| `useNavigate()` | Программная навигация после создания поста, клика на профиль |
| `useParams()` | Извлечение `:id` из URL в страницах Profile, PostDetail |
| `<Outlet>` | Рендер дочерних маршрутов внутри AppLayout |

### Tailwind CSS 4 (стилизация)

| | |
|---|---|
| **Что это** | Utility-first CSS-фреймворк |
| **Зачем** | Быстрая стилизация компонентов через классы прямо в JSX |
| **Какую проблему решает** | Не нужно создавать и поддерживать отдельные CSS-файлы. Не нужно придумывать имена классов (BEM). Стили живут рядом с разметкой, что ускоряет разработку и упрощает чтение кода |
| **Версия** | 4.1.18 |

**Примеры использования в проекте:**

```jsx
// Вместо CSS-файла с классом .avatar-container
<div className="h-[40px] w-[40px] rounded-full overflow-hidden" />

// Адаптивный дизайн
<div className="hidden md:block" />   // Скрыто на мобильных, видно на десктопе

// Состояния
<button className="hover:opacity-70 cursor-pointer" />
```

### React Hook Form (формы)

| | |
|---|---|
| **Что это** | Библиотека для управления формами в React |
| **Зачем** | Валидация, обработка отправки, управление состоянием полей форм |
| **Какую проблему решает** | Без неё каждое поле формы требует отдельного `useState`, обработчика `onChange`, логики валидации. React Hook Form делает это автоматически, работая через `ref` без лишних ре-рендеров |
| **Версия** | 7.54.2 |

**Используется в:**
- `Login.jsx` — форма логина
- `Register.jsx` — форма регистрации
- `ProfileEdit.jsx` — редактирование профиля
- `PostCreateContent.jsx` — создание поста

### PostCSS + Autoprefixer (обработка CSS)

| | |
|---|---|
| **Что это** | PostCSS — инструмент для трансформации CSS. Autoprefixer — плагин для добавления вендорных префиксов |
| **Зачем** | Tailwind CSS работает как PostCSS-плагин. Autoprefixer добавляет `-webkit-`, `-moz-` для кроссбраузерности |
| **Какую проблему решает** | Гарантирует, что CSS корректно работает во всех браузерах |

### tailwindcss-animate (анимации)

| | |
|---|---|
| **Что это** | Плагин анимаций для Tailwind CSS |
| **Зачем** | Готовые классы для анимаций (fade-in, slide-in и т.д.) |
| **Какую проблему решает** | Не нужно писать `@keyframes` вручную |
| **Версия** | 1.0.7 |

---

## Переменные окружения

### Backend (`backend/.env`)

| Переменная | Пример | Назначение |
|---|---|---|
| `PORT` | `4000` | Порт HTTP-сервера |
| `MONGO_URI` | `mongodb://localhost:27017/ichgram` | Строка подключения к MongoDB |
| `JWT_SECRET` | `random_secret_string` | Секретный ключ для подписи JWT-токенов |
| `JWT_EXPIRES_IN` | `7d` | Время жизни токена (7 дней) |
| `CORS_ORIGIN` | `http://localhost:5173` | Разрешённый origin для CORS |

### Frontend (`frontend/.env`)

| Переменная | Пример | Назначение |
|---|---|---|
| `VITE_API_BASE_URL` | `http://localhost:4000/api` | Базовый URL API-сервера |

---

## Сводная таблица зависимостей

### Backend (`backend/package.json`)

| Пакет | Версия | Категория | Назначение |
|---|---|---|---|
| express | 5.2.1 | production | HTTP-фреймворк |
| mongoose | 9.1.5 | production | ODM для MongoDB |
| jsonwebtoken | 9.0.2 | production | Создание/проверка JWT |
| bcryptjs | 2.4.3 | production | Хеширование паролей |
| multer | 1.4.5-lts.1 | production | Загрузка файлов |
| cors | 2.8.6 | production | CORS-заголовки |
| dotenv | 17.2.3 | production | Переменные окружения |
| nodemon | 3.1.11 | dev | Автоперезапуск сервера |

### Frontend (`frontend/package.json`)

| Пакет | Версия | Категория | Назначение |
|---|---|---|---|
| react | 18.3.1 | production | UI-библиотека |
| react-dom | 18.3.1 | production | Рендеринг React в DOM |
| react-router-dom | 6.28.0 | production | Client-side маршрутизация |
| react-hook-form | 7.54.2 | production | Управление формами |
| tailwindcss | 4.1.18 | dev | CSS-фреймворк |
| tailwindcss-animate | 1.0.7 | dev | CSS-анимации |
| vite | 7.2.4 | dev | Сборщик |
| @vitejs/plugin-react | 4.3.2 | dev | Vite-плагин для React (JSX, Fast Refresh) |
| postcss | 8.5.6 | dev | CSS-процессор |
| autoprefixer | 10.4.23 | dev | Вендорные префиксы |
